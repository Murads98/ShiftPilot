<!-- Generic Modal Form Template -->
<div class="modal-header">
    <h5 class="modal-title">{{ modal_title }}</h5>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<form id="modalForm" method="post">
    {% csrf_token %}
    <div class="modal-body">
        {% if form.non_field_errors %}
        <div class="alert alert-danger">
            {{ form.non_field_errors }}
        </div>
        {% endif %}

        {% for field in form %}
        <div class="mb-3">
            <label for="{{ field.id_for_label }}" class="form-label">
                {{ field.label }}
                {% if field.field.required %}<span class="text-danger">*</span>{% endif %}
            </label>

            {% if field.field.widget.input_type == 'checkbox' %}
                <div class="form-check">
                    {{ field }}
                    <label class="form-check-label" for="{{ field.id_for_label }}">
                        {{ field.help_text }}
                    </label>
                </div>
            {% elif field.field.widget.input_type == 'select' %}
                <select name="{{ field.name }}" id="{{ field.id_for_label }}" class="form-select {% if field.errors %}is-invalid{% endif %}" {% if field.field.required %}required{% endif %}>
                    {% if not field.field.required %}
                    <option value="">---------</option>
                    {% endif %}
                    {% for choice_value, choice_label in field.field.choices %}
                    <option value="{{ choice_value }}" {% if field.value == choice_value or field.value|stringformat:"s" == choice_value|stringformat:"s" %}selected{% endif %}>{{ choice_label }}</option>
                    {% endfor %}
                </select>
            {% elif field.field.widget.input_type == 'textarea' %}
                <textarea name="{{ field.name }}" id="{{ field.id_for_label }}" class="form-control {% if field.errors %}is-invalid{% endif %}" rows="3" {% if field.field.required %}required{% endif %}>{{ field.value|default:'' }}</textarea>
            {% else %}
                <input type="{{ field.field.widget.input_type }}" name="{{ field.name }}" id="{{ field.id_for_label }}" class="form-control {% if field.errors %}is-invalid{% endif %}" value="{{ field.value|default:'' }}" {% if field.field.required %}required{% endif %}>
            {% endif %}

            {% if field.help_text and field.field.widget.input_type != 'checkbox' %}
            <div class="form-text">{{ field.help_text }}</div>
            {% endif %}

            {% if field.errors %}
            <div class="invalid-feedback d-block">
                {{ field.errors }}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">{{ submit_text|default:"Save" }}</button>
    </div>
</form>
